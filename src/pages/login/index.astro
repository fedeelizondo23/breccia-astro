---
const title = "Login";
import Layout from "@/layouts/Layout.astro";
import NavBar from "@/components/NavBar.astro";
---
<Layout>
    <NavBar />
<html>
  <head>
    <title>{title}</title>
  </head>
  <body>
    <h1>{title}</h1>
    <form id="login-form">
      <input type="email" name="email" placeholder="Correo electrónico" required />
      <input type="password" name="password" placeholder="Contraseña" required />
      <button type="submit">Ingresar</button>
    </form>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("login-form");

        if (!(form instanceof HTMLFormElement)) {
          console.error("No se encontró un formulario válido.");
          return;
        }

        form.onsubmit = async function (event) {
          event.preventDefault();

          const formData = new FormData(form);
          const user = {
            email: formData.get("email"),
            password: formData.get("password"),
          };

          try {
            const response = await fetch("http://localhost:5000/api/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(user),
            });

            const data = await response.json();
            if (data.token) {
              localStorage.setItem("token", data.token);
              alert("Inicio de sesión exitoso");
              window.location.href = "/"; // Redirigir a la página principal
            } else {
              alert(data.error || "Error en el inicio de sesión");
            }
          } catch (error) {
            alert("Error al iniciar sesión");
          }
        };
      });
    </script>
  </body>
</html>
</Layout>
