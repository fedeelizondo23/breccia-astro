---
import "@/styles/global.css";
import NavBar from "@/components/NavBar.astro";

const { title, description } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="{Astro.generator}" />
    <meta name="description" content={description} />
    <title>Breccia Marmol | {title}</title>
  </head>
  <body class="bg-gray-100 text-gray-900 font-sans">
    <!-- Navbar -->
  

    <!-- Contenido dinámico -->
    <main class="container mx-auto p-6">
      <slot />
    </main>

    <!-- Script de autenticación en el cliente -->
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const token = localStorage.getItem("token");
        if (token) {
          try {
            const response = await fetch("http://localhost:5000/api/auth/profile", {
              method: "GET",
              headers: { "Authorization": "Bearer " + token },
            });
            const data = await response.json();
            
            // Modificar los botones de login/register en lugar de duplicar el nav
            const loginButton = document.getElementById("login-btn");
            const registerButton = document.getElementById("register-btn");
            const userContainer = document.getElementById("user-info");

            if (data.username) {
              if (loginButton) loginButton.style.display = "none";
              if (registerButton) registerButton.style.display = "none";
              if (userContainer) {
                userContainer.innerHTML = `
                  <span class="text-green-400">Bienvenido, ${data.username}</span>
                  <button onclick="logout()" class="ml-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Cerrar sesión</button>
                `;
              }
            }
          } catch (error) {
            console.error("Error al obtener usuario:", error);
          }
        }
      });

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "/login";
      }
    </script>
  </body>
</html>
